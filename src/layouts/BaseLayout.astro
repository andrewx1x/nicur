---
import "../styles/global.css";
import HeaderNav from "../components/HeaderNav.astro";
import FooterContacts from "../components/FooterContacts.astro";
import Container from "../components/Container.astro";
import { site } from "../config/site";
import { withBase } from "../utils/paths";

const { title, description, canonical } = Astro.props;
const pageTitle = title ? `${title} | ${site.name}` : site.name;
const pageDescription = description || site.description;
const canonicalUrl = canonical || new URL(Astro.url.pathname, Astro.site).toString();
---
<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription} />
    <meta name="robots" content="noindex, nofollow" />
    <link rel="canonical" href={canonicalUrl} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />
    <meta property="og:image" content={new URL(withBase("/og-image.svg"), Astro.site).toString()} />
    <meta property="og:type" content="website" />
    <link rel="icon" href={withBase("/favicon.svg")} type="image/svg+xml" />
  </head>
  <body>
    <div class="notice-banner">
      <Container>
        {site.notice}
      </Container>
    </div>
    <HeaderNav currentPath={Astro.url.pathname} />
    <main>
      <slot />
    </main>
    <FooterContacts />
    <script>
      const elements = document.querySelectorAll('.reveal');
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('in-view');
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.15 }
      );
      elements.forEach((element) => observer.observe(element));

      // Carousel functionality
      document.querySelectorAll('.carousel').forEach(carousel => {
        const slides = carousel.querySelectorAll('.carousel-slide');
        const dots = carousel.querySelectorAll('.carousel-dot');
        const prevBtn = carousel.querySelector('.carousel-prev');
        const nextBtn = carousel.querySelector('.carousel-next');
        let currentIndex = 0;

        function showSlide(index) {
          slides.forEach((slide, i) => {
            slide.classList.toggle('active', i === index);
          });
          dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === index);
          });
          currentIndex = index;
        }

        prevBtn?.addEventListener('click', () => {
          const newIndex = currentIndex === 0 ? slides.length - 1 : currentIndex - 1;
          showSlide(newIndex);
        });

        nextBtn?.addEventListener('click', () => {
          const newIndex = currentIndex === slides.length - 1 ? 0 : currentIndex + 1;
          showSlide(newIndex);
        });

        dots.forEach((dot, index) => {
          dot.addEventListener('click', () => showSlide(index));
        });
      });
    </script>
  </body>
</html>
